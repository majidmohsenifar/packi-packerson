<!DOCTYPE html>
<html lang="en" x-data="packCalculator()" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8" />
    <title>Pack Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 2rem auto; }
        input, button { padding: 0.5rem; margin: 0.2rem 0; width: 100%; }
        form { margin-bottom: 1.5rem; }
        .result { background: #f0f0f0; padding: 1rem; margin-top: 1rem; border-radius: 5px; }
        <!-- .sizes-list { margin-top: 0.5rem; padding: 0; list-style: none; } -->
        <!-- .sizes-list li { background: #eee; padding: 0.3rem 0.5rem; margin: 0.2rem 0; border-radius: 3px; display: flex; justify-content: space-between; } -->
        <!-- .remove-btn { cursor: pointer; color: red; font-weight: bold; } -->

        .sizes-tags {
           display: flex;
           flex-wrap: wrap;
           gap: 0.5rem;
           padding: 0;
           margin: 0.5rem 0;
           list-style: none;
        }

        .sizes-tags li {
            background: #e5e7eb; /* light gray */
            border-radius: 6px;
            padding: 0.3rem 0.6rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            font-weight: bold;
        }

        .remove-btn {
            cursor: pointer;
            color: #b91c1c; /* dark red */
            font-weight: bold;
        }

    </style>
</head>
<body>

<h1>ðŸ“¦ Pack Calculator</h1>

<!-- Form A: Submit package sizes -->
<form @submit.prevent="submitSizes">
    <h2>Set Package Sizes</h2>
    <label>Add New Size</label>
    <input type="number" x-model.number="newSize" placeholder="Example: 750" />
    <button type="button" @click="addSize">Add Size</button>
    <ul class="sizes-tags">
    <template x-for="(size, index) in sizes" :key="size">
        <li>
            <span x-text="size"></span>
            <span class="remove-btn" @click="removeSize(index)">âœ–</span>
        </li>
    </template>
    </ul>
    <button type="submit">Save Sizes</button>
</form>

<!-- Form B: Calculate pack distribution -->
<form @submit.prevent="calculatePacks">
    <h2>Calculate Order</h2>
    <label>Order Quantity</label>
    <input type="number" x-model.number="orderQuantity" placeholder="Enter total quantity" />
    <button type="submit">Calculate</button>
</form>

<!-- Result -->
<div class="result" x-show="Object.keys(result.packs).length > 0">
    <h3>Result</h3>
    <p>Ordered: <strong x-text="result.ordered"></strong></p>
    <ul>
        <template x-for="[size, count] in Object.entries(result.packs)" :key="size">
            <li>
                <strong x-text="size"></strong> pack Ã— 
                <span x-text="count"></span>
            </li>
        </template>
    </ul>
</div>

<script>
function packCalculator() {
    return {
        sizes: [5000, 2000, 1000, 500, 250],
        newSize: null,
        orderQuantity: null,
        result: { ordered: 0, packs: {} },

        addSize() {
            if (this.newSize && !this.sizes.includes(this.newSize)) {
                this.sizes.push(this.newSize);
                this.newSize = null;
            }
        },

        removeSize(index) {
            this.sizes.splice(index, 1);
        },

        async submitSizes() {
            try {
                let res = await fetch('/set-sizes', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ sizes: this.sizes })
                });
                let json = await res.json();

                if (json.status) {
                    this.sizes = json.data.sizes; // Update from server response
                    alert('Sizes saved!');
                } else {
                    alert('Error saving sizes');
                }
            } catch (err) {
                console.error(err);
                alert('Error saving sizes');
            }
        },

        async calculatePacks() {
            try {
                let res = await fetch(`/correct?x=${this.orderQuantity}`);
                let json = await res.json();

                if (json.status) {
                    this.result = json.data;
                } else {
                    alert('API returned an error');
                }
            } catch (err) {
                console.error(err);
                alert('Error calculating packs');
            }
        }
    }
}
</script>
</body>
</html>

